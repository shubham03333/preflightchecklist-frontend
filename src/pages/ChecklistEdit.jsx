import React, { useEffect, useState } from 'react';
import { getChecklist, updateChecklist, updateItem, deleteItem, addItem } from '../api';
import { useParams, useNavigate } from 'react-router-dom';
export default function ChecklistEdit(){ const {id}=useParams(); const nav=useNavigate(); const [form,setForm]=useState(null); const [newCheck,setNewCheck]=useState(''); useEffect(()=>{ (async()=>{ const d=await getChecklist(id); setForm(d); })(); },[id]); if(!form) return <div>Loading...</div>; const save=async()=>{ await updateChecklist(id,{flight_number:form.flight_number}); nav('/'); }; const addNew=async()=>{ if(!newCheck) return; await addItem(id,{check_text:newCheck,sequence:form.items.length}); setNewCheck(''); const d=await getChecklist(id); setForm(d); }; return (<div className="card"><h2 className="text-lg font-semibold mb-3">Edit Checklist</h2><input className="border p-2 rounded mb-2 w-full" value={form.flight_number} onChange={e=>setForm({...form,flight_number:e.target.value})} /><div className="mb-3"><button onClick={save} className="bg-sky-600 text-white px-3 py-1 rounded">Save</button></div><h3 className="font-semibold mb-2">Items</h3><div className="space-y-2 mb-3">{form.items.map(it=>(<div key={it.id} className="flex justify-between items-center border p-2 rounded"><div>{it.check_text}</div><div className="flex gap-2"><button onClick={async()=>{ await updateItem(it.id,{status: it.status==='Completed'?'Pending':'Completed'}); const d=await getChecklist(id); setForm(d); }} className="px-2 py-1 rounded bg-green-600 text-white">{it.status}</button><button onClick={async()=>{ if(confirm('Delete?')){ await deleteItem(it.id); const d=await getChecklist(id); setForm(d); }}} className="px-2 py-1 rounded bg-red-600 text-white">Delete</button></div></div>))}</div><div className="flex gap-2"><input className="border p-2 rounded flex-1" value={newCheck} onChange={e=>setNewCheck(e.target.value)} /><button onClick={addNew} className="bg-green-600 text-white px-3 py-1 rounded">Add</button></div></div>); }
